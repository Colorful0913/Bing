C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg51.h>
   2          #include<intrins.h>
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          sbit RS=P2^6;
   6          sbit RW=P2^5;
   7          sbit E=P2^7;
   8          sbit K1=P1^0;
   9          sbit K2=P1^1;
  10          sbit K3=P1^2;
  11          sbit K4=P1^3;
  12          sbit K5=P1^4;
  13          sbit BEEP=P3^0;
  14          unsigned char cishu=0;
  15          unsigned char mode_flag;//×´Ì¬±êÖ¾Î» 0±íÊ¾Õý´¦ÓÚÕý³££¬1ÉèÖÃÊ±¼ä£¬2ÉèÖÃÄÖÖÓ
  16          unsigned char Current_Time[]={"Current Time  "};     
  17          unsigned char Set_time[]={"Set New Time..."};      
  18          unsigned char Set_nao[]={"Set nao Time..."};       
  19          unsigned char show_time[]={">00:00:00"};
  20          unsigned char now_shi=12,now_fen=30,now_miao;//ÔËÐÐÊ±µÄÊ±¼ä±äÁ¿
  21          unsigned char temp_shi,temp_fen,temp_miao;//µ÷Ê±¼äµÄÊ±¼ä±äÁ¿
  22          unsigned char nao_shi=13,nao_fen=30,nao_miao;//ÄÖÖÓµÄÊ±¼ä±äÁ¿
  23          unsigned char flag_sf; //0±íÊ¾ÉèÖÃÊ±£¬1±íÊ¾ÉèÖÃ·Ö
  24          //¸èÇúÒôµ÷±àÂë
  25          uchar code SONG_TONE[]={212,212,190,212,159,169,212,212,190,212,142,159,212,212,106,126,159,169,190,119,11
             -9,126,159,142,159,0};
  26          //¸èÇú³¤Òô½Ú
  27          uchar code SONG_LONG[]={9,3,12,12,12,24,9,3,12,12,12,24,9,3,12,12,12,12,12,9,3,12,12,12,24,0};
  28          void display_mode();
  29          void display_time(unsigned char shi,unsigned char fen,unsigned char miao);  
  30          void keyscan();
  31          void PlayMusic();
  32          void lcd_w_cmd(unsigned char com);
  33          void lcd_w_dat(unsigned char dat);
  34          void lcd_int ();
  35          void delay1(unsigned int i);
  36          unsigned char lcd_r_start();
  37          void been(unsigned int time);
  38          void main()
  39          {      
  40   1        lcd_int ();    //³õÊ¼»¯lcd
  41   1        mode_flag=0;//ÔËÐÐ
  42   1        display_mode();   //µ÷ÓÃÏÔÊ¾Ä£Ê½º¯Êý
  43   1        TMOD=0x01;    //³õÊ¼»¯¶¨Ê±Æ÷
  44   1        EA=1;      //´ò¿ª×ÜÖÐ¶Ï
  45   1        TH0=(65536-50000)/256;      //¸³³õÖµ
  46   1        TL0=(65536-50000)%256;
  47   1        ET0=1;               //´ò¿ª¶¨Ê±Æ÷T0ÖÐ¶Ï±êÖ¾Î»
  48   1        TR0=1;              //Æô¶¯T0
  49   1        while(1){     
  50   2            if(mode_flag==0)display_time(now_shi,now_fen,now_miao);     //×´Ì¬±êÖ¾Î»mode_flag=0±íÊ¾Õý´¦ÓÚÊ±¼äÕý³£ÔËÐ
             -Ð
  51   2            else display_time(temp_shi,temp_fen,temp_miao);       //·ñÔòmode_flagÎª1Ê±ÉèÖÃÊ±¼ä£¬Îª2Ê±ÉèÖÃÄÖÖÓ
  52   2            keyscan();         //µ÷ÓÃ°´¼ü¿ª¹Ø¿ØÖÆº¯Êý
  53   2            if(now_shi==nao_shi&&now_fen==nao_fen&&now_miao==nao_miao) PlayMusic();   //Èç¹ûÕýÔÚÔËÐÐµÄÊ±¼äÎªÄÖÖÓµÄÊ
C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 2   

             -±¼ä£¬ÔòÄÖÁåÏì£¨´ËÎªÒôÀÖ£©
  54   2        } 
  55   1      }
  56          void display_mode()
  57          {
  58   1         
  59   1        unsigned char i;
  60   1        lcd_w_cmd(0x82);     //ÉèÖÃÏÔÊ¾µØÖ·£¨µÚÒ»ÐÐ£©
  61   1        if(mode_flag==0)      //×´Ì¬±êÖ¾Î»mode_flag=0±íÊ¾Õý´¦ÓÚÊ±¼äÕý³£ÔËÐÐ
  62   1        {
  63   2          for(i=0;Current_Time[i]!='\0';i++)    //´Ë´¦ÏÔÊ¾Current_Time[]×Ö·û´®£¬×Ö·û´®½áÊø·ûÎª¡®0¡¯
  64   2          {
  65   3            lcd_w_dat(Current_Time[i]);
  66   3            
  67   3          } 
  68   2        }
  69   1        else if(mode_flag==1)
  70   1        { 
  71   2          for(i=0;Set_time[i]!='\0';i++)    //´Ë´¦ÏÔÊ¾Set_time[]×Ö·û´®£¬×Ö·û´®½áÊø·ûÎª¡®0¡¯
  72   2          {
  73   3            lcd_w_dat(Set_time[i]);
  74   3          
  75   3          }
  76   2        }
  77   1        else if(mode_flag==2)
  78   1        {
  79   2           for(i=0;Set_nao[i]!='\0';i++)    //´Ë´¦ÏÔÊ¾Set_nao[]×Ö·û´®£¬×Ö·û´®½áÊø·ûÎª¡®0¡¯
  80   2          {
  81   3            lcd_w_dat(Set_nao[i]);    
  82   3          }
  83   2        }
  84   1      }
  85          void display_time(unsigned char shi,unsigned char fen,unsigned char miao)//µÚ¶þÐÐµÄÊý×ÖÏÔÊ¾
  86          {
  87   1        unsigned char i;
  88   1        if(mode_flag==0)show_time[0]=' ';  //Èç¹ûmode_flag=0£¬µÚ¶þÐÐµÚ0Î»ÏÔÊ¾' '
  89   1        else  show_time[0]='>';        //·ñÔòµÚ¶þÐÐµÚ0Î»ÏÔÊ¾'>'
  90   1      
  91   1        show_time[1]=shi/10+0x30;      //µÚÒ»Î»ÏÔÊ¾Ê±µÄÊ®Î»Êý
  92   1        show_time[2]=shi%10+0x30;     //µÚ¶þÎ»ÏÔÊ¾Ê±µÄ¸öÎ»Êý
  93   1      
  94   1        show_time[4]=fen/10+'0';       //µÚËÄÎ»ÏÔÊ¾·ÖµÄÊ®Î»Êý
  95   1        show_time[5]=fen%10+'0';       //µÚÎåÎ»ÏÔÊ¾·ÖµÄ¸öÎ»Êý
  96   1      
  97   1        show_time[7]=miao/10+'0';       //µÚÆßÎ»ÏÔÊ¾ÃëµÄÊ®Î»Êý
  98   1        show_time[8]=miao%10+'0';       //µÚ°ËÎ»ÏÔÊ¾ÃëµÄ¸öÎ»Êý
  99   1      
 100   1        lcd_w_cmd(0xC3);  //¸ü¸ÄÏÔÊ¾Î»ÖÃÓÃ
 101   1        for(i=0;show_time[i]!='\0';i++)   //´Ë´¦ÏÔÊ¾show_time[]×Ö·û´®£¬×Ö·û´®½áÊø·ûÎª¡®0¡¯
 102   1        {
 103   2          lcd_w_dat(show_time[i]);
 104   2        
 105   2        }
 106   1      }
 107          void keyscan()            //°´¼ü¿ØÖÆ£¬k1µ÷Ê±»ò·Ö£¬k2¼ÓÊ±»ò·Ö£¬k3¼õÊ±»ò·Ö£¬k4È·¶¨µ÷ºÃµÄÊ±¼ä£¬k5µ÷ÄÖÖÓ
 108          {
 109   1        if(K1==0)
 110   1        {
 111   2          delay1(1000);
 112   2          if(K1==0)
 113   2          {
 114   3            if(mode_flag==0)       //ÕýÔÚÔËÐÐµÄÊ±¼äÒª½øÈëµ÷Ê±¼äµÄ×´Ì¬
C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 3   

 115   3            {
 116   4              been(300);
 117   4                temp_shi=now_shi;   
 118   4              temp_fen=now_fen;
 119   4              temp_miao=now_miao;
 120   4              mode_flag=1;
 121   4            }
 122   3            else{ 
 123   4                been(300);
 124   4                flag_sf=~flag_sf; //ÇÐ»»×´Ì¬£¬flag_sf=0µ÷Ê±ÖÓ flag_sf=1µ÷·ÖÖÓ
 125   4               }
 126   3              display_mode();
 127   3            while(!K1); //ËÉÊÖ¼ì²â
 128   3          }
 129   2        }
 130   1        if(K2==0)             //¼ÓÊ±»ò·Ö
 131   1        {
 132   2          delay1(1000);
 133   2          if(K2==0)
 134   2          {
 135   3            if(mode_flag!=0)      
 136   3            { 
 137   4               been(300);
 138   4               if(flag_sf==0)     //µ÷Ê±ÖÓ×´Ì¬
 139   4               {
 140   5                  temp_shi++;
 141   5                if(temp_shi==24)temp_shi=0;    //Èç¹û¼ÓÊ±ÖÓµ½24¾ÍÇåÁã
 142   5               }
 143   4               else {                //µ÷·ÖÖÓ×´Ì¬
 144   5                  temp_fen++;
 145   5                if(temp_fen==60)temp_fen=0;     //Èç¹û¼Ó·ÖÖÓµ½60¾ÍÇåÁã
 146   5               }          
 147   4            }
 148   3            while(!K2); //ËÉÊÖ¼ì²â
 149   3          } 
 150   2        } 
 151   1        if(K3==0)              //¼õÊ±»ò·Ö
 152   1        {
 153   2          delay1(1000);
 154   2          if(K3==0)
 155   2          {
 156   3            if(mode_flag!=0)
 157   3            {
 158   4              been(300);
 159   4               if(flag_sf==0)        //µ÷Ê±ÖÓ×´Ì¬
 160   4               {
 161   5                
 162   5              if(temp_shi==0)temp_shi=24;   //Èç¹û¼õÊ±ÖÓ¼õµ½×îµÍµ½0¾ÍÓÖ»Øµ½×î¸ßÎ»24
 163   5                  temp_shi--;
 164   5                
 165   5               }
 166   4               else {            //µ÷·ÖÖÓ×´Ì¬
 167   5      
 168   5      if(temp_fen==0)temp_fen=60; //Èç¹û¼õ·ÖÖÓ¼õµ½×îµÍµ½0¾ÍÓÖ»Øµ½×î¸ßÎ»60
 169   5                  temp_fen--; 
 170   5               }  
 171   4            }
 172   3            while(!K3); //ËÉÊÖ¼ì²â
 173   3          }
 174   2        }
 175   1                     //È·¶¨ÉèÖÃµÄÊ±¼äºÍµ÷ºÃÄÖÖÓµÄÊ±¼ä
 176   1        if(K4==0)
C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 4   

 177   1        {
 178   2          delay1(1000);
 179   2          if(K4==0)
 180   2          {
 181   3            if(mode_flag==1) //ÉèÖÃÊ±¼ä  ÉèÖÃºÃµÄÊ±¼äÈ·¶¨ºóÕý³£ÔËÐÐ
 182   3            {
 183   4              been(300);
 184   4              now_shi=temp_shi;        
 185   4              now_fen=temp_fen;
 186   4              now_miao=temp_miao;
 187   4              mode_flag=0;
 188   4            }
 189   3          if(mode_flag==2)  //ÉèÖÃÄÖÖÓ  ÉèÖÃºÃµÄÊ±¼äÈ·¶¨ºÃÖ®ºó¶¨ÎªÄÖÖÓ
 190   3            {                  
 191   4              been(300);
 192   4              nao_shi=temp_shi;
 193   4              nao_fen=temp_fen;
 194   4              nao_miao=temp_miao;
 195   4              mode_flag=0;
 196   4            }
 197   3            while(!K4); //ËÉÊÖ¼ì²â
 198   3          }
 199   2          display_mode();        //µ÷ÓÃÏÔÊ¾Ä£Ê½º¯Êý
 200   2        
 201   2        }
 202   1      
 203   1        if(K5==0)            //ÉèÖÃÄÖÖÓ
 204   1        {
 205   2          delay1(1000);
 206   2          if(K5==0)
 207   2          {
 208   3            if(mode_flag==0)
 209   3            {
 210   4               been(300);
 211   4               mode_flag=2;
 212   4               temp_shi=nao_shi;
 213   4               temp_fen=nao_fen;
 214   4               temp_miao=nao_miao;
 215   4            }     
 216   3            display_mode();
 217   3            while(!K5); //ËÉÊÖ¼ì²â
 218   3          }
 219   2        }
 220   1      }
 221          void been(unsigned int time)
 222          {
 223   1        unsigned int i;
 224   1        for(i=0;i<time;i++)
 225   1        {
 226   2           BEEP=~BEEP;      
 227   2           delay1(10);  
 228   2        }
 229   1      }
 230          void delay(uint ms)    //ÄÖÁåµÄÑÓÊ±º¯Êý
 231          {
 232   1       char t;
 233   1       while(ms--) for(t=0;t<120;t++);
 234   1      }
 235          void PlayMusic()
 236          {
 237   1      uint i=0,j,k;
 238   1      while (SONG_LONG[i]!=0||SONG_TONE[i]!=0)
C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 5   

 239   1       {
 240   2        for(j=0;j<SONG_LONG[i]*30;j++)
 241   2        {
 242   3         BEEP=~BEEP;
 243   3         for(k=0;k<SONG_TONE[i]/4;k++);
 244   3        }
 245   2        delay(10);
 246   2        i++;
 247   2        display_time(now_shi,now_fen,now_miao); 
 248   2       }
 249   1      }
 250          //º¯ÊýÃû£ºtime0
 251          //º¯Êý¹¦ÄÜ£º¶¨Ê±Æ÷T0µÄÖÐ¶Ïº¯Êý£¬T0ÔÚ¹¤×÷·½Ê½1ÏÂÃ¿50ms²úÉúÖÐ¶Ï£¬Ö´ÐÐ¸ÃÖÐ¶Ïº¯Êý
 252          void time0() interrupt 1     
 253          {
 254   1        TH0=(65536-50000)/256;
 255   1        TL0=(65536-50000)%256;
 256   1        cishu++;
 257   1        if(cishu==20)        //Ò»ÃëÊ±¼äµ½ºó£¬´ÎÊýÇåÁã£¬ÃëÊý¼ÓÒ»
 258   1        {
 259   2          cishu=0;
 260   2          now_miao++;
 261   2        }
 262   1        if(now_miao==60)      //60ÃëÊ±¼äµ½ºó£¬ÃëÊýÇåÁã£¬·ÖÖÓ¼ÓÒ»
 263   1        {
 264   2          now_miao=0;
 265   2          now_fen++;
 266   2        }
 267   1      
 268   1        if(now_fen==60)     //60·ÖÖÓÊ±¼äµ½ºó£¬·ÖÖÓÇåÁã£¬Ê±ÖÓ¼ÓÒ»
 269   1        {   
 270   2          now_fen=0;
 271   2          now_shi++;
 272   2        }
 273   1        if(now_shi==24)        //24Ð¡Ê±µ½ºó£¬Ê±ÖÓÇåÁã
 274   1        {
 275   2           now_shi=0;
 276   2        }
 277   1      }
 278          //º¯ÊýÃû£ºlcd_int
 279          //º¯Êý¹¦ÄÜ£ºlcd³õÊ¼»¯
 280          void lcd_int()
 281          {
 282   1        lcd_w_cmd(0x3c);  //ÉèÖÃ¹¤×÷·½Ê½
 283   1        lcd_w_cmd(0x0c);    //ÉèÖÃÏÔÊ¾×´Ì¬
 284   1        lcd_w_cmd(0x01);   //ÇåÆÁ
 285   1        lcd_w_cmd(0x06);   //ÉèÖÃÊäÈë·½Ê½
 286   1        lcd_w_cmd(0x80);   //ÉèÖÃ³õÊ¼ÏÔÊ¾Î»ÖÃ
 287   1      }
 288          //º¯ÊýÃû£ºlcd_w_cmd
 289          //º¯Êý¹¦ÄÜ£ºÐ´ÃüÁî
 290          //ÐÎÊ½²ÎÊý£ºÃüÁî×ÖÒÑ¾­´æÈëcomµ¥ÔªÖÐ
 291          void lcd_w_cmd(unsigned char com)
 292          {
 293   1        unsigned char i;
 294   1        do
 295   1        {            //²élcdÃ¦×´Ì¬
 296   2        i=lcd_r_start();      //µ÷ÓÃ¶Á×´Ì¬×Öº¯Êý
 297   2        i&=0x80;           //¡°Óë¡±²Ù×÷ÆÁ±ÎµôµÍ7Î»
 298   2        delay1(2);
 299   2        }while(i!=0);       //lcdÃ¦£¬¼ÌÐø²éÑ¯£¬·ñÔòÍË³öÑ­»· 
 300   1        RW=0;
C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 6   

 301   1        delay1(1);
 302   1        RS=0;            //RW=0£¬RS=0£¬Ð´lcdÃüÁî×Ö
 303   1        delay1(1);
 304   1        E=1;              //E¶ËÊ±ÐòÒÔ0»ò1¸ßµÍ²¨¶¯
 305   1        delay1(1);
 306   1        P0=com;             //½«comÖÐµÄÃüÁî×ÖÐ´ÈëlcdÊý¾Ý¿Ú
 307   1        delay1(1);
 308   1        E=0;
 309   1        delay1(1);
 310   1        RW=1;
 311   1        delay1(2);
 312   1      }
 313          void lcd_w_dat(unsigned char dat)
 314          {
 315   1        unsigned char i;
 316   1        do
 317   1        {              //²éÃ¦²Ù×÷
 318   2        i=lcd_r_start();       //µ÷ÓÃ¶Á×´Ì¬×Öº¯Êý
 319   2        i&=0x80;           //¡°Óë¡±²Ù×÷ÆÁ±ÎµôµÍ7Î»
 320   2        delay1(2);
 321   2        }while(i!=0);        //lcdÃ¦£¬¼ÌÐø²éÑ¯£¬·ñÔòÍË³öÑ­»· 
 322   1        RW=0;
 323   1        delay1(1);
 324   1        RS=1;            //RW=0£¬RS=1£¬Ð´lcdÃüÁî×Ö
 325   1        delay1(1);
 326   1        E=1;              //E¶ËÊ±ÐòÒÔ0»ò1¸ßµÍ²¨¶¯
 327   1        delay1(1);
 328   1        P0=dat;            //½«datÖÐµÄÏÔÊ¾Êý¾ÝÐ´ÈëlcdÊý¾Ý¿Ú
 329   1        delay1(1);
 330   1        E=0;
 331   1        delay1(1);
 332   1        RW=1;
 333   1        delay1(2);
 334   1      }
 335          void delay1(unsigned int i)
 336          {
 337   1        unsigned int k;
 338   1        for(k=0;k<i;k++);
 339   1      }
 340          //º¯ÊýÃû£ºlcd_r_start
 341          //º¯Êý¹¦ÄÜ£º¶Á×´Ì¬×Ö
 342          unsigned char lcd_r_start()
 343          {
 344   1        unsigned char s;
 345   1        RW=1;       //RW=1,RS=0,¶Álcd×´Ì¬
 346   1        delay1(1);
 347   1        RS=0;
 348   1        delay1(1);
 349   1        E=1;         //E¶ËÊ±ÐòÒÔ0»ò1¸ßµÍ²¨¶¯
 350   1        delay1(1);
 351   1        s=P0;        //´ÓlcdµÄÊý¾Ý¿Ú¶Á×´Ì¬  
 352   1        delay1(1);
 353   1        E=0;
 354   1        delay1(1);
 355   1        RW=0;
 356   1        delay1(1);
 357   1        return(s);       //·µ»ØÖµs¶ÁÈ¡×´Ì¬Ã¦»ò¿ÕÏÐ
 358   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    945    ----
C51 COMPILER V9.60.7.0   MAIN                                                              11/03/2023 09:28:16 PAGE 7   

   CONSTANT SIZE    =     52    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     69      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
