C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: f:\Keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg52.h>                                        //°üº¬Í·ÎÄ¼þ
   2          #include <intrins.h>
   3          
   4          #define uchar unsigned char                               //ÒÔºóunsigned char¾Í¿ÉÒÔÓÃuchar´úÌæ
   5          #define uint  unsigned int                                //ÒÔºóunsigned int ¾Í¿ÉÒÔÓÃuint ´úÌæ
   6          
   7          sfr ISP_DATA  = 0xe2;                           //Êý¾Ý¼Ä´æÆ÷
   8          sfr ISP_ADDRH = 0xe3;                           //µØÖ·¼Ä´æÆ÷¸ß°ËÎ»
   9          sfr ISP_ADDRL = 0xe4;                           //µØÖ·¼Ä´æÆ÷µÍ°ËÎ»
  10          sfr ISP_CMD   = 0xe5;                           //ÃüÁî¼Ä´æÆ÷
  11          sfr ISP_TRIG  = 0xe6;                           //ÃüÁî´¥·¢¼Ä´æÆ÷
  12          sfr ISP_CONTR = 0xe7;                           //¿ØÖÆ¼Ä´æÆ÷
  13          
  14          sbit RS       = P2^7;                                     //1602Òº¾§µÄRS¹Ü½Å       
  15          sbit RW       = P2^6;                                     //1602Òº¾§µÄRW¹Ü½Å 
  16          sbit EN       = P2^5;                                     //1602Òº¾§µÄEN¹Ü½Å
  17          sbit RST      = P1^3;                             //Ê±ÖÓÐ¾Æ¬DS1302µÄRST¹Ü½Å
  18          sbit SDA      = P1^2;                             //Ê±ÖÓÐ¾Æ¬DS1302µÄSDA¹Ü½Å
  19          sbit SCK      = P1^1;                             //Ê±ÖÓÐ¾Æ¬DS1302µÄSCK¹Ü½Å
  20          sbit Key1     = P3^2;                             //ÉèÖÃÊ±¼ä°´¼ü
  21          sbit Key2     = P3^3;                             //ÉèÖÃÄÖÖÓ°´¼ü
  22          sbit Key3     = P3^4;                             //Ãë±í¹¦ÄÜ°´¼ü
  23          sbit Key4     = P3^5;                             //×Ó¹¦ÄÜ°´¼ü1
  24          sbit Key5     = P3^6;                                     //×Ó¹¦ÄÜ°´¼ü2
  25          sbit Buzzer   = P2^0;                             //·äÃùÆ÷
  26          sbit DQ       = P1^0;                             //DS18B20´«¸ÐÆ÷µÄÒý½Å¶¨Òå
  27          
  28          uchar TimeBuff[7] = {17,9,1,6,18,30,40};          //Ê±¼äÊý×é£¬Ä¬ÈÏ2017Äê9ÔÂ1ÈÕ£¬ÐÇÆÚÎå£¬18:30:40
  29          // TimeBuff[0] ´ú±íÄê·Ý£¬·¶Î§00-99
  30          // TimeBuff[1] ´ú±íÔÂ·Ý£¬·¶Î§1-12
  31          // TimeBuff[2] ´ú±íÈÕÆÚ£¬·¶Î§1-31
  32          // TimeBuff[3] ´ú±íÐÇÆÚ£¬·¶Î§1-7£¬1ÊÇÐÇÆÚÌì£¬2ÊÇÐÇÆÚÒ»... ...
  33          // TimeBuff[4] ´ú±íÐ¡Ê±£¬·¶Î§00-23
  34          // TimeBuff[5] ´ú±í·ÖÖÓ£¬·¶Î§00-59
  35          // TimeBuff[6] ´ú±íÃëÖÓ£¬·¶Î§00-59
  36          
  37          uchar Clock_Hour;                               //ÄÖÖÓµÄÐ¡Ê±
  38          uchar Clock_Minute;                                 //ÄÖÖÓµÄ·ÖÖÓ
  39          uchar Clock_Swt;                                //ÄÖÖÓµÄ¿ª¹Ø
  40          uchar Buzzer_Flag = 0;                                //·äÃùÆ÷¹¤×÷±êÖ¾
  41          
  42          uchar Stop_Watch_Count = 0;                             // ÓÃÓÚÃë±í¼ÆÊý£¬10ºÁÃë¼Ó1
  43          uint  Stop_Watch_Second = 0;                            // ÓÃÓÚÃë±í¼ÆÊý£¬1Ãë¼Ó1
  44          
  45          /*********************************************************/
  46          // µ¥Æ¬»úÄÚ²¿EEPROM²»Ê¹ÄÜ
  47          /*********************************************************/
  48          void ISP_Disable()
  49          {
  50   1          ISP_CONTR = 0;                                        //¿ØÖÆ¼Ä´æÆ÷¸³ÖµÎª0
  51   1          ISP_ADDRH = 0;                                        //µØÖ·¼Ä´æÆ÷¸ß°ËÎ»¸³ÖµÎª0
  52   1          ISP_ADDRL = 0;                                        //µØÖ·¼Ä´æÆ÷µÍ°ËÎ»¸³ÖµÎª0
  53   1      }
  54          
  55          /*********************************************************/
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 2   

  56          // ´Óµ¥Æ¬»úÄÚ²¿EEPROM¶ÁÒ»¸ö×Ö½Ú
  57          /*********************************************************/
  58          unsigned char ReadE2PROM(unsigned int addr)
  59          {
  60   1          ISP_DATA = 0x00;                                      //Êý¾Ý¼Ä´æÆ÷ÇåÁã
  61   1          ISP_CONTR = 0x83;                                     //ÔÊÐí¸Ä±äÄÚ²¿E2PROM,´æÈ¡Êý¾ÝËÙ¶ÈÎª5MHz
  62   1          ISP_CMD = 0x01;                                       //¶ÁÃüÁî
  63   1          ISP_ADDRH = (unsigned char)(addr >> 8);               //ÊäÈë¸ß8Î»µØÖ·
  64   1          ISP_ADDRL = (unsigned char)(addr & 0xff);             //ÊäÈëµÍ8Î»µØÖ·
  65   1          ISP_TRIG = 0x46;                                      //ÏÈÏòÃüÁî´¥·¢¼Ä´æÆ÷Ð´Èë0x46
  66   1          ISP_TRIG = 0xb9;                                      //ÔÙÏòÃüÁî´¥·¢¼Ä´æÆ÷Ð´Èë0xb9,Íê³É´¥·¢
  67   1          _nop_();                                              //ÑÓÊ±´óÔ¼1us
  68   1          ISP_Disable();                                        //µ¥Æ¬»úÄÚ²¿EEPROM²»Ê¹ÄÜ
  69   1          
  70   1          return ISP_DATA;                                      //·µ»Ø¶ÁµÄÊý¾Ý
  71   1      }
  72          
  73          /*********************************************************/
  74          // ´Óµ¥Æ¬»úÄÚ²¿EEPROMÐ´Ò»¸ö×Ö½Ú
  75          /*********************************************************/
  76          void WriteE2PROM(unsigned char dat, unsigned int addr)
  77          {
  78   1          ISP_CONTR = 0x83;                                     //ÔÊÐí¸Ä±äÄÚ²¿E2PROM,´æÈ¡Êý¾ÝËÙ¶ÈÎª5MHz
  79   1          ISP_CMD = 0x02;                                       //Ð´ÃüÁî
  80   1          ISP_ADDRH = (unsigned char)(addr >> 8);               //ÊäÈë¸ß8Î»µØÖ·
  81   1          ISP_ADDRL = (unsigned char)(addr & 0xff);             //ÊäÈëµÍ8Î»µØÖ·
  82   1          ISP_DATA = dat;                                       //ÊäÈëÒªÐ´µÄÊý¾Ý
  83   1          ISP_TRIG = 0x46;                                      //ÏÈÏòÃüÁî´¥·¢¼Ä´æÆ÷Ð´Èë0x46
  84   1          ISP_TRIG = 0xb9;                                      //ÔÙÏòÃüÁî´¥·¢¼Ä´æÆ÷Ð´Èë0xb9,Íê³É´¥·¢ 
  85   1          _nop_();                                              //ÑÓÊ±´óÔ¼1us
  86   1          ISP_Disable();                                        //µ¥Æ¬»úÄÚ²¿EEPROM²»Ê¹ÄÜ
  87   1      }
  88          
  89          /*********************************************************/
  90          // ´Óµ¥Æ¬»úÄÚ²¿EEPROMÉÈÇø²Á³ý
  91          /*********************************************************/
  92          void SectorErase(unsigned int addr)
  93          {
  94   1          ISP_CONTR = 0x83;                                     //ÔÊÐí¸Ä±äÄÚ²¿E2PROM,´æÈ¡Êý¾ÝËÙ¶ÈÎª5MHz
  95   1          ISP_CMD = 0x03;                                       //ÉÈÇø²Á³ýÃüÁî
  96   1          ISP_ADDRH = (unsigned char)(addr >> 8);               //ÊäÈë¸ß8Î»µØÖ·
  97   1          ISP_ADDRL = (unsigned char)(addr & 0xff);             //ÊäÈëµÍ8Î»µØÖ·
  98   1          ISP_TRIG = 0x46;                                      //ÏÈÏòÃüÁî´¥·¢¼Ä´æÆ÷Ð´Èë0x46
  99   1          ISP_TRIG = 0xb9;                                      //ÔÙÏòÃüÁî´¥·¢¼Ä´æÆ÷Ð´Èë0xb9,Íê³É´¥·¢
 100   1          _nop_();                                              //ÑÓÊ±´óÔ¼1us
 101   1          ISP_Disable();                                        //µ¥Æ¬»úÄÚ²¿EEPROM²»Ê¹ÄÜ
 102   1      }
 103          
 104          /*********************************************************/
 105          // ÑÓÊ±X*10usº¯Êý
 106          /*********************************************************/
 107          void DelayX10us(unsigned char t)
 108          {
 109   1          do{
 110   2              _nop_();                                          //ÑÓÊ±1us
 111   2              _nop_();                                          //ÑÓÊ±1us
 112   2              _nop_();                                          //ÑÓÊ±1us
 113   2              _nop_();                                          //ÑÓÊ±1us
 114   2              _nop_();                                          //ÑÓÊ±1us
 115   2              _nop_();                                          //ÑÓÊ±1us
 116   2              _nop_();                                          //ÑÓÊ±1us
 117   2              _nop_();                                          //ÑÓÊ±1us
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 3   

 118   2              }while(--t);                                      //tÏÈ×Ô¼õ£¬È»ºóÅÐ¶ÏtµÄÖµÊÇ·ñ´óÓÚ0
 119   1      }
 120          /*********************************************************/
 121          // ¸´Î»18B20
 122          /*********************************************************/
 123          bit Reset18B20()
 124          {
 125   1          bit ack;                                              //¶¨ÒåÒ»¸öbitÐÍ±äÁ¿
 126   1      
 127   1          DQ = 0;                                               //Êý¾ÝÒý½ÅÀ­µÍ
 128   1          DelayX10us(50);                                       //ÑÓÊ±500us
 129   1          DQ = 1;                                               //Êý¾ÝÒý½ÅÀ­¸ß
 130   1          DelayX10us(6);                                        //ÑÓÊ±60us
 131   1          ack = DQ;                                             //¶ÁÈ¡¸´Î»Öµ
 132   1          while(!DQ);                                           //ÅÐ¶ÏÊÇ·ñÎª¸ßµçÆ½
 133   1          
 134   1          return ack;                                           //·µ»Ø¸´Î»Öµ
 135   1      }
 136          /*********************************************************/
 137          // Ïò18B20Ð´Êý¾Ý»òÃüÁî
 138          /*********************************************************/
 139          void Write18B20(unsigned char dat)
 140          {
 141   1          unsigned char mask;                                   //¶¨ÒåÒ»¸ömask±äÁ¿
 142   1          
 143   1          for(mask=0x01; mask!=0; mask<<=1)                     //Ñ­»·8´Î£¬´ÓµÍµ½¸ßÒÀ´ÎÐ´Èë
 144   1          {
 145   2              DQ = 0;                                           //³õÊ¼µçÆ½Îª0
 146   2              _nop_();                                          //ÑÓÊ±´óÔ¼Îª1us
 147   2              _nop_();                                          //ÑÓÊ±´óÔ¼Îª1us
 148   2              if((dat & mask) == 0)                             //ÅÐ¶ÏÐ´ÈëµÄÒ»Î»ÊÇ·ñÎª0
 149   2                  DQ = 0;                                       //Îª0£¬Êý¾ÝÎ»Îª0
 150   2              else
 151   2                  DQ = 1;                                       //·ñÔò£¬Êý¾ÝÎ»Îª1
 152   2              DelayX10us(6);                                    //ÑÓÊ±60us
 153   2              DQ = 1;                                           //À­¸ßÊý¾ÝÎ»£¬ÎªÏÂ´ÎÐ´×÷×¼±¸
 154   2          }
 155   1      }
 156          /*********************************************************/
 157          // ´Ó18B20¶ÁÊý¾Ý»òÃüÁî
 158          /*********************************************************/
 159          unsigned char Read18B20()
 160          {
 161   1          unsigned char mask;                                   //¶¨ÒåÒ»¸ömask±äÁ¿
 162   1          unsigned char dat;                                    //¶¨ÒåÒ»¸ödat±äÁ¿,ÓÃÓÚ±£´æ¶Áµ½µÄÊý¾Ý
 163   1          
 164   1          for(mask=0x01; mask!=0; mask<<=1)                     //Ñ­»·8´Î£¬´ÓµÍµ½¸ßÒÀ´Î¶Á³ö
 165   1          {
 166   2              DQ = 0;                                           //³õÊ¼µçÆ½Îª0
 167   2              _nop_();                                          //ÑÓÊ±´óÔ¼Îª1us
 168   2              _nop_();                                          //ÑÓÊ±´óÔ¼Îª1us
 169   2              DQ = 1;                                           //Êý¾ÝµçÆ½À­¸ß
 170   2              _nop_();                                          //ÑÓÊ±´óÔ¼Îª1us
 171   2              _nop_();                                          //ÑÓÊ±´óÔ¼Îª1us
 172   2              if(DQ == 0)                                       //ÅÐ¶ÁÊý¾ÝÒý½ÅÊÇ·ñÎª0
 173   2                  dat &= ~mask;                                 //ÈôÎª0£¬dat°´Î»ÓëÉÏ0xfe,¶Á³ö0
 174   2              else
 175   2                  dat |= mask;                                  //·ñÔò£¬dat°´Î»»òÉÏ0x01,¶Á³ö1
 176   2              DelayX10us(6);                                    //ÑÓÊ±60us
 177   2          }
 178   1          
 179   1          return dat;                                           //·µ»Ø¶Á³öÊý¾Ýdat
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 4   

 180   1      }
 181          /*********************************************************/
 182          // »ñÈ¡18B20ÎÂ¶ÈÊý¾Ý
 183          /*********************************************************/
 184          int Get18B20Temp()
 185          {
 186   1          bit ack;                                             //¶¨ÒåbitÐÍ±äÁ¿
 187   1          int temp;                                            //¶¨ÒåÓÐ·ûºÅÕûÐÎ±äÁ¿temp,ÓÃÓÚ±£´æÎÂ¶ÈÊý¾Ý
 188   1          unsigned char LSB, MSB;                              //¶¨ÒåÁ½¸öÎÞ·ûºÅ×Ö·ûÐÍ±äÁ¿£¬ÓÃÓÚ±£´æ´Ó18B20ÖÐ¶Á³ö
             -µÄÁ½¸öÊý¾Ý
 189   1          
 190   1          ack = Reset18B20();                                  //»ñÈ¡18B20¸´Î»Î»
 191   1          if(ack == 0)                                         //ÅÐ¶ÁÊÇ·ñ¸´Î»
 192   1          {
 193   2              Write18B20(0xcc);                                //Ìø¹ý¼ì²âROM
 194   2              Write18B20(0x44);                                //Æô¶¯ÎÂ¶È×ª»»Ö¸Áî
 195   2          }
 196   1          
 197   1          ack = Reset18B20();                                  //»ñÈ¡18B20¸´Î»Î»
 198   1          if(ack == 0)                                         //ÅÐ¶ÁÊÇ·ñ¸´Î»
 199   1          {
 200   2              Write18B20(0xcc);                                //Ìø¹ý¼ì²âROM
 201   2              Write18B20(0xbe);                                //¶ÁÈ¡ÎÂ¶ÈÖ¸Áî
 202   2              LSB = Read18B20();                               //ÏÈ¶ÁµÚ8Î»
 203   2              MSB = Read18B20();                               //ÔÙ¶Á¸ß8Î»
 204   2              temp = ((int)MSB<<8) + LSB;                      //¸ß8Î»£¬µÚ8Î»ÕûºÏ³ÉÒ»¸öÓÐ·ûºÅµÄÕûÐÍ±äÁ¿£¬²¢°ÑÖµ±
             -£´æÔÚtempÖÐ
 205   2              temp = temp * 0.0625 * 10;                       //ºÏ³ÉÎÂ¶ÈÖµ²¢·Å´ó10±¶
 206   2          }
 207   1          
 208   1          return temp;                                         //·µ»Ø¶Áµ½µÄÎÂ¶ÈÊýÖµ
 209   1      }
 210          
 211          /********************************************************/
 212          // ÑÓÊ±X*msº¯Êý
 213          /********************************************************/
 214          void DelayMs(unsigned int ms)
 215          {
 216   1          unsigned int i, j;                                    //¶¨ÒåÁ½¸öÎÞ·ûºÅÕûÐÎ±äÁ¿i,j
 217   1          
 218   1          for(i=0; i<ms; i++)                                   
 219   1              for(j=0; j<112; j++);
 220   1      }
 221          /*********************************************************/
 222          // 1602Òº¾§Ð´ÃüÁîº¯Êý£¬cmd¾ÍÊÇÒªÐ´ÈëµÄÃüÁî
 223          /*********************************************************/
 224          void WriteLcdCmd(uchar cmd)
 225          { 
 226   1        RS = 0;                                               //Êý¾ÝÃüÁîÑ¡ÔñÒý½ÅÖÃÎªµÍµçÆ½£¬Ñ¡ÔñÐ´ÈëÃüÁî
 227   1        RW = 0;                                               //¶ÁÐ´Ñ¡ÔñÒý½ÅÖÃÎªµÍµçÆ½£¬Ñ¡ÔñÐ´Èë
 228   1        EN = 0;                                               //Ê¹ÄÜÒý½ÅÖÃÎªµÍµçÆ½
 229   1        P0=cmd;                                               //ÒªÐ´ÈëµÄÃüÁî¸³Öµ¸øP0¶Ë¿Ú
 230   1        DelayMs(2);                                           //ÑÓÊ±2ms
 231   1        EN = 1;                                               //Ê¹ÄÜÒý½ÅÖÃÎª¸ßµçÆ½
 232   1        DelayMs(2);                                           //ÑÓÊ±2ms
 233   1        EN = 0;                                               //Ê¹ÄÜÒý½ÅÖÃÎªµÍµçÆ½
 234   1      }
 235          /*********************************************************/
 236          // 1602Òº¾§Ð´Êý¾Ýº¯Êý£¬dat¾ÍÊÇÒªÐ´ÈëµÄÊý¾Ý
 237          /*********************************************************/
 238          void WriteLcdData(uchar dat)
 239          {
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 5   

 240   1        RS = 1;                                               //Êý¾ÝÃüÁîÑ¡ÔñÒý½ÅÖÃÎª¸ßµçÆ½£¬Ñ¡ÔñÐ´ÈëÊý¾Ý
 241   1        RW = 0;                                               //¶ÁÐ´Ñ¡ÔñÒý½ÅÖÃÎªµÍµçÆ½£¬Ñ¡ÔñÐ´Èë
 242   1        EN = 0;                                               //Ê¹ÄÜÒý½ÅÖÃÎªµÍµçÆ½
 243   1        P0=dat;                                               //ÒªÐ´ÈëµÄÊý¾Ý¸³Öµ¸øP0¶Ë¿Ú
 244   1        DelayMs(2);                                           //ÑÓÊ±2ms
 245   1        EN = 1;                                               //Ê¹ÄÜÒý½ÅÖÃÎª¸ßµçÆ½ 
 246   1        DelayMs(2);                                           //ÑÓÊ±2ms
 247   1        EN = 0;                                               //Ê¹ÄÜÒý½ÅÖÃÎªµÍµçÆ½
 248   1      }
 249          
 250          /*********************************************************/
 251          // Òº¾§×ø±êÉèÖÃº¯Êý
 252          /*********************************************************/
 253          void SetLcdCursor(unsigned char line, unsigned char column)
 254          {
 255   1          if(line == 0)                                         //ÅÐ¶ÏÊÇ·ñÎªµÚÒ»ÐÐ
 256   1              WriteLcdCmd(column + 0x80);                       //ÈôÊÇ£¬Ð´ÈëµÚÒ»ÐÐÁÐ×ø±ê
 257   1          if(line == 1)                                         //ÅÐ¶ÏÊÇ·ñÎªµÚ¶þÐÐ
 258   1              WriteLcdCmd(column + 0x80 + 0x40);                //ÈôÊÇ£¬Ð´ÈëµÚ¶þÐÐÁÐ×ø±ê
 259   1      }
 260          /*********************************************************/
 261          // Òº¾§ÏÔÊ¾×Ö·û´®º¯Êý
 262          /*********************************************************/
 263          void ShowLcdStr(unsigned char *str)
 264          {
 265   1          while(*str != '\0')                                  //µ±Ã»ÓÐÖ¸Ïò½áÊø·û
 266   1              WriteLcdData(*str++);                            //×Ö·ûÖ¸Õë¼Ó1
 267   1      }
 268          /*********************************************************/
 269          // Òº¾§³õÊ¼»¯º¯Êý
 270          /*********************************************************/
 271          void LcdInit()
 272          {
 273   1          WriteLcdCmd(0x38);                                    //16*2ÏÔÊ¾£¬5*7µãÕó£¬8Î»Êý¾Ý¿Ú
 274   1          WriteLcdCmd(0x06);                                    //µØÖ·¼Ó1£¬µ±Ð´ÈëÊý¾Ýºó¹â±êÓÒÒÆ
 275   1          WriteLcdCmd(0x0c);                                    //¿ªÏÔÊ¾£¬²»ÏÔÊ¾¹â±ê
 276   1          WriteLcdCmd(0x01);                                    //ÇåÆÁ
 277   1      }
 278          /*********************************************************/
 279          // Òº¾§ÏÔÊ¾ÄÚÈÝµÄ³õÊ¼»¯
 280          /*********************************************************/
 281          void ShowLcdInit()
 282          {
 283   1          SetLcdCursor(0, 0);                                   //ÉèÖÃ×ø±êµÚÒ»ÐÐ£¬µÚÒ»ÁÐ
 284   1          ShowLcdStr("20  -  -        ");                       //ÏÔÊ¾"20  -  -        "
 285   1          SetLcdCursor(1, 0);                                   //ÉèÖÃ×ø±êµÚ¶þÐÐ£¬µÚÒ»ÁÐ
 286   1          ShowLcdStr("  :  :         C");                       //ÏÔÊ¾"  :  :         C"
 287   1          SetLcdCursor(1, 14);                                  //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ15ÁÐ
 288   1          WriteLcdData(0xdf);                                   //ÎÂ¶Èµ¥Î»ÉãÊÏ¶ÈÉÏÃæµÄÔ²È¦·ûºÅ
 289   1      }
 290          /*********************************************************/
 291          // Òº¾§Êä³öÊý×Ö
 292          /*********************************************************/
 293          void ShowLcdNum(unsigned char num)
 294          {
 295   1          WriteLcdData(num/10 + 48);                            //·ÖÀë³öÊ®Î»
 296   1          WriteLcdData(num%10 + 48);                            //·ÖÀë³ö¸öÎ»
 297   1      }
 298          /*********************************************************/
 299          // Òº¾§ÏÔÊ¾ÐÇÆÚ
 300          /*********************************************************/
 301          void ShowLcdWeek(uchar week)
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 6   

 302          {
 303   1          switch(week)
 304   1          {
 305   2              case 1: ShowLcdStr("Sun");  break;                //weekÎª1£¬ÏÔÊ¾Sun
 306   2              case 2: ShowLcdStr("Mon");  break;                //weekÎª2£¬ÏÔÊ¾Mon
 307   2              case 3: ShowLcdStr("Tue");  break;                //weekÎª3£¬ÏÔÊ¾Tue
 308   2              case 4: ShowLcdStr("Wed");  break;                //weekÎª4£¬ÏÔÊ¾Wed
 309   2              case 5: ShowLcdStr("Thu");  break;                //weekÎª5£¬ÏÔÊ¾Thu
 310   2              case 6: ShowLcdStr("Fri");  break;                //weekÎª6£¬ÏÔÊ¾Fri
 311   2              case 7: ShowLcdStr("Sat");  break;                //weekÎª7£¬ÏÔÊ¾Sat
 312   2              default:                    break;                //½áÊøswithcÅÐ¶Ï
 313   2          }
 314   1      }
 315          /*********************************************************/
 316          // ÔÚÒº¾§ÉÏÏÔÊ¾ÎÂ¶È
 317          /*********************************************************/
 318          void ShowLcdTemp(int temp)
 319          {
 320   1        if(temp < 0)                                        //Èç¹ûÎÂ¶ÈÎª¸ºÊý              
 321   1        {
 322   2          WriteLcdData('-');                    //ÏÔÊ¾¸ººÅ  
 323   2          temp = 0 - temp;                  //¸ºÊý×ªÎªÕýÊý
 324   2        }
 325   1        else if(temp >= 1000)                                 //ÎÂ¶ÈÖµ´óÓÚµÈÓÚ100¡æ               
 326   1        {
 327   2          WriteLcdData(temp/1000 + 0x30);                 //·ÖÀë³ö°ÙÎ»  
 328   2        }
 329   1          else
 330   1        {
 331   2          WriteLcdData(' ');                                //¼Ó¸ö¿Õ¸ñ
 332   2        }
 333   1        WriteLcdData(temp%1000/100 + 0x30);                   //·ÖÀë³öÊ®Î»
 334   1        WriteLcdData(temp%100/10 + 0x30);                 //·ÖÀë³ö¸öÎ»
 335   1        WriteLcdData('.');                      //Ìí¼ÓÐ¡Êýµã
 336   1        WriteLcdData(temp%10+0x30);                     //Ð¡ÊýºóÒ»Î»
 337   1      }
 338          /*********************************************************/
 339          // Ë¢ÐÂÊ±¼äÏÔÊ¾
 340          /*********************************************************/
 341          void FlashTime()
 342          {
 343   1          SetLcdCursor(0, 2);                                   //ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ3ÁÐ
 344   1          ShowLcdNum(TimeBuff[0]);                              //ÏÔÊ¾Äê·Ý
 345   1          
 346   1          SetLcdCursor(0, 5);                                   //ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ6ÁÐ
 347   1          ShowLcdNum(TimeBuff[1]);                              //ÏÔÊ¾ÔÂ·Ý
 348   1          
 349   1          SetLcdCursor(0, 8);                                   //ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ9ÁÐ
 350   1          ShowLcdNum(TimeBuff[2]);                              //ÏÔÊ¾ÈÕÆÚ
 351   1          
 352   1          SetLcdCursor(1, 0);                                   //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ1ÁÐ
 353   1          ShowLcdNum(TimeBuff[4]);                              //ÏÔÊ¾Ð¡Ê±
 354   1          
 355   1          SetLcdCursor(1, 3);                                   //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ4ÁÐ
 356   1          ShowLcdNum(TimeBuff[5]);                              //ÏÔÊ¾·ÖÖÓ
 357   1          
 358   1          SetLcdCursor(1, 6);                                   //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ7ÁÐ
 359   1          ShowLcdNum(TimeBuff[6]);                              //ÏÔÊ¾ÃëÖÓ
 360   1          
 361   1          SetLcdCursor(0, 12);                                  //ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ13ÁÐ
 362   1          ShowLcdWeek(TimeBuff[3]);                             //ÏÔÊ¾ÐÇÆÚ  
 363   1      }
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 7   

 364          
 365          /*********************************************************/
 366          // ³õÊ¼»¯DS1302
 367          /*********************************************************/
 368          void DS1302_Init(void)
 369          {
 370   1          RST = 0;                                              //RST½ÅÖÃµÍ
 371   1          SCK = 0;                                              //SCK½ÅÖÃµÍ
 372   1          SDA = 0;                                              //SDA½ÅÖÃµÍ 
 373   1      }
 374          /*********************************************************/
 375          // ÏòDS1302Ð´ÈëÒ»×Ö½ÚÊý¾Ý
 376          /*********************************************************/
 377          void DS1302_Write_Byte(uchar addr, uchar dat)
 378          {
 379   1          uchar i;                                              //¶¨ÒåÎÞ·ûºÅ±äÁ¿i£¬forÑ­»·ÓÃ  
 380   1          
 381   1          RST = 1;                                              //RSTÒý½ÅÀ­Îª¸ßµçÆ½ 
 382   1          
 383   1          /* Ð´ÈëÄ¿±êµØÖ·£ºaddr*/
 384   1          for(i=0; i<8; i++)                                    //Ñ­»·8´Î 
 385   1          {
 386   2              if(addr & 0x01)                                   //ÅÐ¶Ïaddr×îºóÒ»Î»ÊÇ·ñÎª1 
 387   2                  SDA = 1;                                      //ÈôÎª1£¬SDAÒý½ÅÊä³öÎª1 
 388   2              else                                              //·ñÔò
 389   2                  SDA = 0;                                      //SDAÒý½ÅÊä³öÎª0 
 390   2              SCK = 1;                                          //SCKÀ­Îª¸ßµçÆ½ 
 391   2              _nop_();                                          //ÑÓÊ±1us 
 392   2              SCK = 0;                                          //SCKÀ­ÎªµÍµçÆ½ 
 393   2              _nop_();                                          //ÑÓÊ±1us 
 394   2              
 395   2              addr = addr >> 1;                                 //addrÏòÓÒÒÆ¶¯Ò»Î» 
 396   2          }
 397   1          
 398   1          /* Ð´ÈëÊý¾Ý£ºdat*/
 399   1          for(i=0; i<8; i++)                                    //Ñ­»·8´Î 
 400   1          {
 401   2              if(dat & 0x01)                                    //ÅÐ¶Ïdat×îºóÒ»Î»ÊÇ·ñÎª1  
 402   2                  SDA = 1;                                      //ÈôÎª1£¬SDAÒý½ÅÊä³öÎª1 
 403   2              else                                              //·ñÔò 
 404   2                  SDA = 0;                                      //SDAÒý½ÅÊä³öÎª0 
 405   2              SCK = 1;                                          //SCKÀ­Îª¸ßµçÆ½ 
 406   2              _nop_();                                          //ÑÓÊ±1us 
 407   2              SCK = 0;                                          //SCKÀ­ÎªµÍµçÆ½ 
 408   2              _nop_();                                          //ÑÓÊ±1us 
 409   2              
 410   2              dat = dat >> 1;                                   //addrÏòÓÒÒÆ¶¯Ò»Î» 
 411   2          }
 412   1          
 413   1          RST = 0;                                              //RSTÒý½ÅÀ­ÎªµÍµçÆ½ 
 414   1      }
 415          /*********************************************************/
 416          // ´ÓDS1302¶Á³öÒ»×Ö½ÚÊý¾Ý
 417          /*********************************************************/
 418          uchar DS1302_Read_Byte(uchar addr)
 419          {
 420   1          uchar i;                                              //¶¨ÒåÎÞ·ûºÅ±äÁ¿i£¬forÑ­»·ÓÃ 
 421   1          uchar temp;                                           //tempÓÃÀ´±£´æ¶Áµ½µÄÊý¾Ý 
 422   1          
 423   1          RST = 1;                                              //RSTÒý½ÅÀ­Îª¸ßµçÆ½ 
 424   1          
 425   1          /* Ð´ÈëÄ¿±êµØÖ·£ºaddr*/
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 8   

 426   1          for(i=0; i<8; i++)                                    //Ñ­»·8´Î  
 427   1          {
 428   2              if(addr & 0x01)                                   //ÅÐ¶Ïaddr×îºóÒ»Î»ÊÇ·ñÎª1  
 429   2                  SDA = 1;                                      //ÈôÎª1£¬SDAÒý½ÅÊä³öÎª1  
 430   2              else                                              //·ñÔò  
 431   2                  SDA = 0;                                      //SDAÒý½ÅÊä³öÎª0  
 432   2              SCK = 1;                                          //SCKÀ­Îª¸ßµçÆ½ 
 433   2              _nop_();                                          //ÑÓÊ±1us 
 434   2              SCK = 0;                                          //SCKÀ­ÎªµÍµçÆ½ 
 435   2              _nop_();                                          //ÑÓÊ±1us 
 436   2              
 437   2              addr = addr >> 1;                                 //addrÏòÓÒÒÆ¶¯Ò»Î» 
 438   2          }
 439   1          
 440   1          /* ¶Á³ö¸ÃµØÖ·µÄÊý¾Ý */
 441   1          for(i=0; i<8; i++)                                    //Ñ­»·8´Î 
 442   1          {
 443   2              temp = temp >> 1;                                 //tempÏòÓÒÒÆ¶¯Ò»Î» 
 444   2              
 445   2              if(SDA == 1)                                      //ÅÐ¶ÏSDAÊÇ·ñÎª1 
 446   2                  temp |= 0x80;                                 //ÈôÎª1£¬temp°´Î»»òÉÏ0x80 
 447   2              else                                              //·ñÔò
 448   2                  temp &= 0x7f;                                 //temp°´Î»ÓëÉÏ0x7f 
 449   2              SCK = 1;                                          //SCKÀ­Îª¸ßµçÆ½ 
 450   2              _nop_();                                          //ÑÓÊ±1us 
 451   2              SCK = 0;                                          //SCKÀ­ÎªµÍµçÆ½ 
 452   2              _nop_();                                          //ÑÓÊ±1us 
 453   2          }
 454   1          
 455   1          RST = 0;                                              //RSTÒý½ÅÀ­ÎªµÍµçÆ½ 
 456   1          
 457   1          return temp;                                          //·µ»Ø¶Áµ½µÄÊý¾Ý 
 458   1      }
 459          /*********************************************************/
 460          // ÏòDS1302Ð´ÈëÊ±¼äÊý¾Ý
 461          /*********************************************************/
 462          void DS1302_Write_Time()
 463          {
 464   1          uchar i;                                              //¶¨ÒåÎÞ·ûºÅ×Ö·ûÐÍ±äÁ¿i£¬forÑ­»·Ê¹ÓÃ
 465   1          uchar temp1;                                          //temp1ÓÃÀ´±£´æ×ª»»³ÉµÄ¶þ½øÖÆµÄÊ®Î»
 466   1          uchar temp2;                                          //temp2ÓÃÀ´±£´æ×ª»»³ÉµÄ¶þ½øÖÆµÄ¸öÎ»
 467   1          
 468   1          for(i=0; i<7; i++)                                    //Ñ­»·7´Î
 469   1          {
 470   2              temp1 = (TimeBuff[i]/10) << 4;                    //·ÖÀë³öÊ®Î»²¢×óÒÆ4Î»
 471   2              temp2 = TimeBuff[i] % 10;                         //·ÖÀë³ö¸öÎ»
 472   2              TimeBuff[i] = temp1 + temp2;                      //Ê®Î»Óë¸öÎ»ÕûºÏ
 473   2          }
 474   1          
 475   1          DS1302_Write_Byte(0x8E, 0x00);                        //¹Ø±ÕÐ´±£»¤
 476   1          DS1302_Write_Byte(0x80, 0x80);                        //ÔÝÍ£Ê±ÖÓ
 477   1          DS1302_Write_Byte(0x8C, TimeBuff[0]);                 //Äê
 478   1          DS1302_Write_Byte(0x88, TimeBuff[1]);                 //ÔÂ
 479   1          DS1302_Write_Byte(0x86, TimeBuff[2]);                 //ÈÕ
 480   1          DS1302_Write_Byte(0x8A, TimeBuff[3]);                 //ÐÇÆÚ
 481   1          DS1302_Write_Byte(0x84, TimeBuff[4]);                 //Ê±
 482   1          DS1302_Write_Byte(0x82, TimeBuff[5]);                 //·Ö
 483   1          DS1302_Write_Byte(0x80, TimeBuff[6]);                 //Ãë
 484   1          DS1302_Write_Byte(0x80, TimeBuff[6]&0x7F);            //ÔËÐÐÊ±ÖÓ
 485   1          DS1302_Write_Byte(0x8E, 0x80);                        //´ò¿ªÐ´±£»¤
 486   1      }
 487          /*********************************************************/
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 9   

 488          // ´ÓDS1302¶Á³öÊ±¼äÊý¾Ý
 489          /*********************************************************/
 490          void DS1302_Read_Time()
 491          {
 492   1          uchar i;                                              //¶¨ÒåÎÞ·ûºÅ×Ö·ûÐÍ±äÁ¿i£¬forÑ­»·Ê¹ÓÃ
 493   1          
 494   1          TimeBuff[0] = DS1302_Read_Byte(0x8D);         //Äê 
 495   1        TimeBuff[1] = DS1302_Read_Byte(0x89);           //ÔÂ 
 496   1        TimeBuff[2] = DS1302_Read_Byte(0x87);         //ÈÕ 
 497   1        TimeBuff[3] = DS1302_Read_Byte(0x8B);         //ÐÇÆÚ
 498   1        TimeBuff[4] = DS1302_Read_Byte(0x85);         //Ê± 
 499   1        TimeBuff[5] = DS1302_Read_Byte(0x83);         //·Ö 
 500   1        TimeBuff[6] = (DS1302_Read_Byte(0x81)) & 0x7F;      //Ãë 
 501   1          
 502   1          for(i=0;i<7;i++)                                  //BCD×ªÊ®½øÖÆ
 503   1        {           
 504   2          TimeBuff[i] = (TimeBuff[i]/16)*10 + TimeBuff[i]%16;
 505   2        }
 506   1      }
 507          
 508          /*********************************************************/
 509          // °´¼ü°´ÏÂÈ¥ÌáÊ¾Éù
 510          /*********************************************************/
 511          void KeySound()
 512          {
 513   1          Buzzer = 0;                                           //·äÃùÆ÷Ïì
 514   1          DelayMs(40);                                          //ÑÓÊ±40ms
 515   1          Buzzer = 1;                                           //·äÃùÆ÷²»Ïì
 516   1      }
 517          
 518          /*********************************************************/
 519          // °´¼üÉ¨Ãè(ÉèÖÃÊ±¼ä)
 520          /*********************************************************/
 521          void KeyScanf1()
 522          {
 523   1          if(Key1 == 0)                                         //¼ì²âÉèÖÃ¼üÊÇ·ñ±»°´ÏÂ
 524   1          {
 525   2              KeySound();                                       //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 526   2              WriteLcdCmd(0x0f);                            //Æô¶¯¹â±êÉÁË¸
 527   2              SetLcdCursor(0,3);                        //¶¨Î»¹â±êµ½Äê·ÝÉÁË¸
 528   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 529   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 530   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 531   2              
 532   2              /* µ÷ÕûÄê·Ý */
 533   2              while(1)
 534   2              {
 535   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 536   3                  {
 537   4                      if(TimeBuff[0] > 0)             //ÅÐ¶ÏÄê·ÝÊÇ·ñ´óÓÚ0
 538   4                          TimeBuff[0]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 539   4                      KeySound();
 540   4                      SetLcdCursor(0, 2);             //¹â±ê¶¨Î»µ½Äê·ÝµÄÎ»ÖÃ
 541   4                      ShowLcdNum(TimeBuff[0]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÄê·Ý
 542   4                      SetLcdCursor(0, 3);                       //¶¨Î»¹â±êµ½Äê·ÝÉÁË¸
 543   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 544   4                  }
 545   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»ÏÂÈ¥
 546   3                  {
 547   4                      if(TimeBuff[0] < 99)            //ÅÐ¶ÏÄê·ÝÊÇ·ñÐ¡ÓÚ99
 548   4                          TimeBuff[0]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 549   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 10  

 550   4                      SetLcdCursor(0, 2);             //¹â±ê¶¨Î»µ½Äê·ÝµÄÎ»ÖÃ
 551   4                      ShowLcdNum(TimeBuff[0]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÄê·Ý
 552   4                      SetLcdCursor(0, 3);                       //¶¨Î»¹â±êµ½Äê·ÝÉÁË¸
 553   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 554   4                  }
 555   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 556   3            {
 557   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 558   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 559   4            }    
 560   3              } 
 561   2      
 562   2              SetLcdCursor(0,6);                        //¶¨Î»¹â±êµ½ÔÂ·ÝÉÁË¸           
 563   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 564   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 565   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 566   2      
 567   2              /* µ÷ÕûÔÂ·Ý */
 568   2              while(1)
 569   2              {
 570   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 571   3                  {
 572   4                      if(TimeBuff[1] > 1)             //ÅÐ¶ÏÔÂ·ÝÊÇ·ñ´óÓÚ1
 573   4                          TimeBuff[1]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 574   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 575   4                      SetLcdCursor(0, 5);             //¹â±ê¶¨Î»µ½ÔÂ·ÝµÄÎ»ÖÃ
 576   4                      ShowLcdNum(TimeBuff[1]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÔÂ·Ý
 577   4                      SetLcdCursor(0, 6);                       //¶¨Î»¹â±êµ½ÔÂ·ÝÉÁË¸
 578   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 579   4                  }
 580   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»ÏÂÈ¥
 581   3                  {
 582   4                      if(TimeBuff[1] < 12)            //ÅÐ¶ÏÔÂ·ÝÊÇ·ñÐ¡ÓÚ12
 583   4                          TimeBuff[1]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 584   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 585   4                      SetLcdCursor(0, 5);             //¹â±ê¶¨Î»µ½ÔÂ·ÝµÄÎ»ÖÃ
 586   4                      ShowLcdNum(TimeBuff[1]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÔÂ·Ý
 587   4                      SetLcdCursor(0, 6);                       //¶¨Î»¹â±êµ½ÔÂ·ÝÉÁË¸
 588   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 589   4                  }
 590   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 591   3            {
 592   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 593   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 594   4            }    
 595   3              } 
 596   2              
 597   2              SetLcdCursor(0,9);                        //¶¨Î»¹â±êµ½ÈÕÆÚÉÁË¸           
 598   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 599   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 600   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 601   2              /* µ÷ÕûÈÕÆÚ */
 602   2              while(1)
 603   2              {
 604   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 605   3                  {
 606   4                      if(TimeBuff[2] > 1)             //ÅÐ¶ÏÈÕÆÚÊÇ·ñ´óÓÚ1
 607   4                          TimeBuff[2]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 608   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 609   4                      SetLcdCursor(0, 8);             //¹â±ê¶¨Î»µ½ÈÕÆÚµÄÎ»ÖÃ
 610   4                      ShowLcdNum(TimeBuff[2]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÈÕÆÚ
 611   4                      SetLcdCursor(0, 9);                       //¶¨Î»¹â±êµ½ÈÕÆÚÉÁË¸
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 11  

 612   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 613   4                  }
 614   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»ÏÂÈ¥
 615   3                  {
 616   4                      if(TimeBuff[2] < 31)            //ÅÐ¶ÏÈÕÆÚÊÇ·ñÐ¡ÓÚ31
 617   4                          TimeBuff[2]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 618   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 619   4                      SetLcdCursor(0, 8);             //¹â±ê¶¨Î»µ½ÈÕÆÚµÄÎ»ÖÃ
 620   4                      ShowLcdNum(TimeBuff[2]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÈÕÆÚ
 621   4                      SetLcdCursor(0, 9);                       //¶¨Î»¹â±êµ½ÈÕÆÚÉÁË¸
 622   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 623   4                  }
 624   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 625   3            {
 626   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 627   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 628   4            }    
 629   3              }
 630   2              
 631   2              SetLcdCursor(0,14);                       //¶¨Î»¹â±êµ½ÐÇÆÚÉÁË¸           
 632   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 633   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 634   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 635   2              
 636   2              /* µ÷ÕûÐÇÆÚ */
 637   2              while(1)
 638   2              {
 639   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 640   3                  {
 641   4                      if(TimeBuff[3] > 1)             //ÅÐ¶ÏÐÇÆÚÊÇ·ñ´óÓÚ1
 642   4                          TimeBuff[3]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 643   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 644   4                      SetLcdCursor(0, 12);            //¹â±ê¶¨Î»µ½ÐÇÆÚµÄÎ»ÖÃ
 645   4                      ShowLcdWeek(TimeBuff[3]);             //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÐÇÆÚ
 646   4                      SetLcdCursor(0, 14);                      //¶¨Î»¹â±êµ½ÐÇÆÚÉÁË¸
 647   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 648   4                  }
 649   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 650   3                  {
 651   4                      if(TimeBuff[3] < 7)             //ÅÐ¶ÏÐÇÆÚÊÇ·ñÐ¡ÓÚ7
 652   4                          TimeBuff[3]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 653   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 654   4                      SetLcdCursor(0, 12);            //¹â±ê¶¨Î»µ½ÈÕÆÚµÄÎ»ÖÃ
 655   4                      ShowLcdWeek(TimeBuff[3]);             //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÐÇÆÚ
 656   4                      SetLcdCursor(0, 14);                      //¶¨Î»¹â±êµ½ÐÇÆÚÉÁË¸
 657   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 658   4                  }
 659   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 660   3            {
 661   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 662   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 663   4            }    
 664   3              }
 665   2              
 666   2              SetLcdCursor(1,1);                        //¶¨Î»¹â±êµ½Ð¡Ê±ÉÁË¸           
 667   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 668   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 669   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 670   2              /* µ÷ÕûÐ¡Ê± */
 671   2              while(1)
 672   2              {
 673   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 12  

 674   3                  {
 675   4                      if(TimeBuff[4] > 0)             //ÅÐ¶ÏÐ¡Ê±ÊÇ·ñ´óÓÚ0
 676   4                          TimeBuff[4]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 677   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 678   4                      SetLcdCursor(1, 0);             //¹â±ê¶¨Î»µ½Ð¡Ê±µÄÎ»ÖÃ
 679   4                      ShowLcdNum(TimeBuff[4]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÐ¡Ê±
 680   4                      SetLcdCursor(1, 1);                       //¶¨Î»¹â±êµ½Ð¡Ê±ÉÁË¸
 681   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 682   4                  }
 683   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 684   3                  {
 685   4                      if(TimeBuff[4] < 23)            //ÅÐ¶ÏÐ¡Ê±ÊÇ·ñÐ¡ÓÚ23
 686   4                          TimeBuff[4]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 687   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 688   4                      SetLcdCursor(1, 0);             //¹â±ê¶¨Î»µ½Ð¡Ê±µÄÎ»ÖÃ
 689   4                      ShowLcdNum(TimeBuff[4]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÐ¡Ê±
 690   4                      SetLcdCursor(1, 1);                       //¶¨Î»¹â±êµ½Ð¡Ê±ÉÁË¸
 691   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 692   4                  }
 693   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 694   3            {
 695   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 696   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 697   4            }    
 698   3              }
 699   2              
 700   2              SetLcdCursor(1,4);                        //¶¨Î»¹â±êµ½·ÖÖÓÉÁË¸           
 701   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 702   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 703   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 704   2              /* µ÷Õû·ÖÖÓ */
 705   2              while(1)
 706   2              {
 707   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 708   3                  {
 709   4                      if(TimeBuff[5] > 0)             //ÅÐ¶Ï·ÖÖÓÊÇ·ñ´óÓÚ0
 710   4                          TimeBuff[5]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 711   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 712   4                      SetLcdCursor(1, 3);             //¹â±ê¶¨Î»µ½·ÖÖÓµÄÎ»ÖÃ
 713   4                      ShowLcdNum(TimeBuff[5]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄ·ÖÖÓ
 714   4                      SetLcdCursor(1, 4);                       //¶¨Î»¹â±êµ½·ÖÖÓÉÁË¸
 715   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 716   4                  }
 717   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 718   3                  {
 719   4                      if(TimeBuff[5] < 59)            //ÅÐ¶Ï·ÖÖÓÊÇ·ñÐ¡ÓÚ59
 720   4                          TimeBuff[5]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 721   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 722   4                      SetLcdCursor(1, 3);             //¹â±ê¶¨Î»µ½·ÖÖÓµÄÎ»ÖÃ
 723   4                      ShowLcdNum(TimeBuff[5]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄ·ÖÖÓ
 724   4                      SetLcdCursor(1, 4);                       //¶¨Î»¹â±êµ½·ÖÖÓÉÁË¸
 725   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 726   4                  }
 727   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 728   3            {
 729   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 730   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 731   4            }    
 732   3              }
 733   2              
 734   2              SetLcdCursor(1,7);                        //¶¨Î»¹â±êµ½ÃëÖÓÉÁË¸           
 735   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 13  

 736   2              while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 737   2              DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 738   2              /* µ÷ÕûÃëÖÓ */
 739   2              while(1)
 740   2              {
 741   3                  if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 742   3                  {
 743   4                      if(TimeBuff[6] > 0)             //ÅÐ¶ÏÃëÖÓÊÇ·ñ´óÓÚ0
 744   4                          TimeBuff[6]--;                        //ÊÇµÄ»°¾Í¼õÈ¥1
 745   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 746   4                      SetLcdCursor(1, 6);             //¹â±ê¶¨Î»µ½ÃëÖÓµÄÎ»ÖÃ
 747   4                      ShowLcdNum(TimeBuff[6]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÃëÖÓ
 748   4                      SetLcdCursor(1, 7);                       //¶¨Î»¹â±êµ½ÃëÖÓÉÁË¸
 749   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 750   4                  }
 751   3                  if(Key5 == 0)                   //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 752   3                  {
 753   4                      if(TimeBuff[6] < 59)            //ÅÐ¶ÏÃëÖÓÊÇ·ñÐ¡ÓÚ59
 754   4                          TimeBuff[6]++;                        //ÊÇµÄ»°¾Í¼ÓÉÏ1
 755   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 756   4                      SetLcdCursor(1, 6);             //¹â±ê¶¨Î»µ½ÃëÖÓµÄÎ»ÖÃ
 757   4                      ShowLcdNum(TimeBuff[6]);              //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÃëÖÓ
 758   4                      SetLcdCursor(1, 7);                       //¶¨Î»¹â±êµ½ÃëÖÓÉÁË¸
 759   4                      DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 760   4                  }
 761   3                  if(Key1 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 762   3            {
 763   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 764   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 765   4            }    
 766   3              }
 767   2              /* ÍË³öÇ°µÄÉèÖÃ */
 768   2          WriteLcdCmd(0x0C);                            //¹Ø±Õ¹â±êÉÁË¸
 769   2          DS1302_Write_Time();                          //°ÑÐÂÉèÖÃµÄÊ±¼äÖµ´æÈëDS1302Ð¾Æ¬
 770   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 771   2          while(!Key1);                             //µÈ´ý°´¼üÊÍ·Å
 772   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯        
 773   2          }
 774   1      }
 775          /*********************************************************/
 776          // °´¼üÉ¨Ãè(ÉèÖÃÄÖÖÓ)
 777          /*********************************************************/
 778          void KeyScanf2()
 779          {
 780   1         if(Key2 == 0)                                          //ÅÐ¶ÏÄÖÖÓÒý½ÅÊÇ·ñ°´ÏÂ
 781   1         {
 782   2             KeySound();                                        //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 783   2             SetLcdCursor(0,0);                                 // ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ1ÁÐ
 784   2             ShowLcdStr("Alarm Clock Set ");                    //Òº¾§ÏÔÊ¾ÎªÄÖÖÓÉèÖÃµÄ½çÃæ
 785   2             SetLcdCursor(1,0);                                 //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ1ÁÐ
 786   2             ShowLcdStr("     :          ");                    //ÏÔÊ¾×Ö·û´®"     :          "
 787   2             SetLcdCursor(1,3);                                 // ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ4ÁÐ
 788   2             ShowLcdNum(Clock_Hour);                            //ÏÔÊ¾ÄÖÖÓµÄÐ¡Ê±
 789   2             SetLcdCursor(1,6);                                 //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ7ÁÐ
 790   2             ShowLcdNum(Clock_Minute);                          //ÏÔÊ¾ÄÖÖÓµÄ·ÖÖÓ
 791   2             SetLcdCursor(1,10);                                //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ11ÁÐ
 792   2             if(Clock_Swt==0)                                   //ÅÐ¶ÏÄÖÖÓÊÇ·ñ¹Ø±Õ
 793   2          {
 794   3            ShowLcdStr("OFF");                            //Èô¹Ø±ÕÏÔÊ¾"OFF"
 795   3          }
 796   2          else                                              //·ñÔò
 797   2          {
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 14  

 798   3            ShowLcdStr(" ON");                            //ÏÔÊ¾" ON"
 799   3          }
 800   2              SetLcdCursor(1,4);                  //¹â±ê¶¨Î»
 801   2              WriteLcdCmd(0x0f);                  //¹â±êÉÁË¸
 802   2              DelayMs(10);                    //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 803   2          while(!Key2);                     //µÈ´ý°´¼üÊÍ·Å
 804   2          DelayMs(10);                    //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 805   2              
 806   2              /* µ÷ÕûÄÖÖÓÐ¡Ê± */
 807   2              while(1)
 808   2          {
 809   3            if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 810   3            {
 811   4              if(Clock_Hour > 0)              //ÅÐ¶ÏÄÖÖÓÐ¡Ê±ÊÇ·ñ´óÓÚ0
 812   4                Clock_Hour--;             //ÊÇµÄ»°¾Í¼õÈ¥1
 813   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 814   4              SetLcdCursor(1,3);              //¹â±ê¶¨Î»µ½ÄÖÖÓÐ¡Ê±µÄÎ»ÖÃ
 815   4              ShowLcdNum(Clock_Hour);                 //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÄÖÖÓÐ¡Ê±
 816   4              SetLcdCursor(1,4);              //¶¨Î»¹â±êµ½ÄÖÖÓÐ¡Ê±ÉÁË¸
 817   4              DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 818   4            }
 819   3            
 820   3            if(Key5 == 0)                 //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 821   3            {
 822   4              if(Clock_Hour < 23)             //ÅÐ¶ÏÄÖÖÓÐ¡Ê±ÊÇ·ñÐ¡ÓÚ23
 823   4                Clock_Hour++;             //ÊÇµÄ»°¾Í¼ÓÉÏ1
 824   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 825   4              SetLcdCursor(1,3);              //¹â±ê¶¨Î»µ½ÄÖÖÓÐ¡Ê±µÄÎ»ÖÃ
 826   4              ShowLcdNum(Clock_Hour);                 //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÄÖÖÓÐ¡Ê±
 827   4              SetLcdCursor(1,4);              //¶¨Î»¹â±êµ½ÄÖÖÓÐ¡Ê±ÉÁË¸
 828   4              DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 829   4            }
 830   3            
 831   3            if(Key2 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 832   3            {
 833   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 834   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 835   4            }
 836   3          }
 837   2                  
 838   2          SetLcdCursor(1,7);                        //¶¨Î»¹â±êµ½ÄÖÖÓ·ÖÖÓµÄÉÁË¸
 839   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 840   2          while(!Key2);                               //µÈ´ý°´¼üÊÍ·Å
 841   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 842   2          
 843   2          /* µ÷Õû·ÖÖÓ */
 844   2          while(1)
 845   2          {
 846   3            if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 847   3            {
 848   4              if(Clock_Minute > 0)            //ÅÐ¶ÏÄÖÖÓ·ÖÖÓÊÇ·ñ´óÓÚ0
 849   4                Clock_Minute--;             //ÊÇµÄ»°¾Í¼õÈ¥1
 850   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 851   4              SetLcdCursor(1,6);              //¹â±ê¶¨Î»µ½ÄÖÖÓ·ÖÖÓµÄÎ»ÖÃ
 852   4              ShowLcdNum(Clock_Minute);               //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÄÖÖÓ·ÖÖÓ
 853   4              SetLcdCursor(1,7);              //¶¨Î»¹â±êµ½ÄÖÖÓ·ÖÖÓÉÁË¸
 854   4              DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 855   4            }
 856   3            
 857   3            if(Key5 == 0)                 //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 858   3            {
 859   4              if(Clock_Minute < 59)           //ÅÐ¶ÏÄÖÖÓ·ÖÖÓÊÇ·ñÐ¡ÓÚ59
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 15  

 860   4                Clock_Minute++;             //ÊÇµÄ»°¾Í¼ÓÉÏ1
 861   4                      KeySound();
 862   4              SetLcdCursor(1,6);              //¹â±ê¶¨Î»µ½ÄÖÖÓ·ÖÖÓµÄÎ»ÖÃ
 863   4              ShowLcdNum(Clock_Minute);               //Ë¢ÐÂÏÔÊ¾¸Ä±äºóµÄÄÖÖÓ·ÖÖÓ
 864   4              SetLcdCursor(1,7);              //¶¨Î»¹â±êµ½ÄÖÖÓ·ÖÖÓÉÁË¸
 865   4              DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 866   4            }
 867   3            
 868   3            if(Key2 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 869   3            {
 870   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 871   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 872   4            }
 873   3          }
 874   2              
 875   2          SetLcdCursor(1,12);                         //¶¨Î»¹â±êµ½ÄÖÖÓ¿ª¹ØµÄÎ»ÖÃÉÁË¸
 876   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 877   2          while(!Key2);                               //µÈ´ý°´¼üÊÍ·Å
 878   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 879   2              /* ÄÖÖÓ¿ª¹Ø */
 880   2          while(1)
 881   2          {
 882   3            if(Key4 == 0)                   //Èç¹û¼õ°´¼ü±»°´ÏÂÈ¥
 883   3            {
 884   4              if(Clock_Swt == 1)              //ÅÐ¶ÏÄÖÖÓÊÇ·ñ¿ªÆô
 885   4                Clock_Swt = 0;              //¹Ø±ÕÄÖÖÓ
 886   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 887   4              SetLcdCursor(1,10);             //¹â±ê¶¨Î»µ½ÃëÖÓ¿ª¹ØµÄÎ»ÖÃ
 888   4              ShowLcdStr("OFF");                //Òº¾§ÏÔÊ¾¡°OFF¡±
 889   4              SetLcdCursor(1,12);             //¶¨Î»¹â±êµ½ÄÖÖÓ¿ª¹ØµÄÎ»ÖÃÉÁË¸
 890   4              DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 891   4            }
 892   3            
 893   3            if(Key5 == 0)                 //Èç¹û¼Ó°´¼ü±»°´ÏÂÈ¥
 894   3            {
 895   4              if(Clock_Swt == 0)              //ÅÐ¶ÏÄÖÖÓÊÇ·ñ¹Ø±Õ
 896   4                Clock_Swt = 1;              //Æô¶¯ÄÖÖÓ
 897   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 898   4              SetLcdCursor(1,10);             //¹â±ê¶¨Î»µ½ÃëÖÓ¿ª¹ØµÄÎ»ÖÃ
 899   4              ShowLcdStr(" ON");                //Òº¾§ÏÔÊ¾¡° ON¡±
 900   4              SetLcdCursor(1,12);             //¶¨Î»¹â±êµ½ÄÖÖÓ¿ª¹ØµÄÎ»ÖÃÉÁË¸
 901   4              DelayMs(300);               //ÑÓÊ±0.3Ãë×óÓÒ
 902   4            }     
 903   3            if(Key2 == 0)                                 //Èç¹ûÉèÖÃ¼ü±»°´ÏÂ
 904   3            {
 905   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 906   4              break;                                    //ÍË³ö´Ëwhile(1)Ñ­»·
 907   4            }
 908   3          }
 909   2              
 910   2              /* ÍË³öÇ°µÄÉèÖÃ */
 911   2          WriteLcdCmd(0x0C);                            //¹Ø±Õ¹â±êÉÁË¸
 912   2          ShowLcdInit();                            //Òº¾§ÏÔÊ¾ÄÚÈÝ»Ö¸´Îª¼ì²â½çÃæµÄ
 913   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 914   2          while(!Key2);                               //µÈ´ý°´¼üÊÍ·Å
 915   2          DelayMs(10);                          //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 916   2          SectorErase(0x2000);
 917   2          WriteE2PROM(Clock_Hour, 0x2000);            //Íù0x2000Õâ¸öµØÖ·Ð´ÈëÄÖÖÓµÄÐ¡Ê± 
 918   2          WriteE2PROM(Clock_Minute, 0x2001);              //Íù0x2001Õâ¸öµØÖ·Ð´ÈëÄÖÖÓµÄ·ÖÖÓ
 919   2          WriteE2PROM(Clock_Swt, 0x2002);             //Íù0x2002Õâ¸öµØÖ·Ð´ÈëÄÖÖÓµÄ¿ª¹Ø      
 920   2         }
 921   1      }
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 16  

 922          /*********************************************************/
 923          // ½øÈë/ÍË³ö Ãë±í
 924          /*********************************************************/
 925          void KeyScanf3()
 926          {
 927   1          if(Key3 == 0)                                         //ÅÐ¶ÏÃë±íÉèÖÃ°´¼üÊÇ·ñ±»°´ÏÂ
 928   1          {
 929   2              KeySound();                                       //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 930   2              SetLcdCursor(0, 0);                               //ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ1ÁÐ
 931   2              ShowLcdStr("   Stop_Watch   ");                   //ÏÔÊ¾×Ö·û´®"   Stop-Watch   "
 932   2              SetLcdCursor(1, 0);                               //ÉèÖÃ×ø±êµÚ1ÐÐ£¬µÚ2ÁÐ
 933   2              ShowLcdStr("  00:00:00 00   ");                   //ÏÔÊ¾×Ö·û´®"  00:00:00 00   "
 934   2              
 935   2              DelayMs(10);                                      //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 936   2              while(!Key3);                                     //µÈ´ý°´¼üÊÍ·Å
 937   2              DelayMs(10);                                      //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 938   2              
 939   2              /* Ãë±í¿ØÖÆ */
 940   2              while(Key3)                                       //ÅÐ¶Ï°´¼ü3ÊÇµ¯Æð
 941   2              {
 942   3                  // Ãë±íµÄ¿ªÊ¼ºÍÔÝÍ£ÇÐ»»
 943   3                  if(Key4 == 0)                                 //ÅÐ¶Ï°´¼ü4ÊÇ·ñ±»°´ÏÂ
 944   3                  {
 945   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 946   4                      if(TR1 == 0)                              //¹Ø±ä¿ª
 947   4                      {
 948   5                          TR1 = 1;
 949   5                      }
 950   4                      else                                      //¿ª±ä¹Ø
 951   4                      {
 952   5                          TR1 = 0;
 953   5                      }
 954   4                      DelayMs(10);                              //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 955   4                      while(!Key4);                             //µÈ´ý°´¼üÊÍ·Å
 956   4                      DelayMs(10);                              //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 957   4                  }
 958   3                  
 959   3                  // Ãë±íÇåÁã
 960   3                  if(Key5 == 0)                                 //ÅÐ¶Ï°´¼ü5ÊÇ·ñ±»°´ÏÂ
 961   3                  {
 962   4                      KeySound();                               //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 963   4                      Stop_Watch_Count = 0;                     //¼ÆÊý±äÁ¿1ÇåÁã
 964   4                      Stop_Watch_Second = 0;                    //¼ÆÊý±äÁ¿2ÇåÁã
 965   4                      SetLcdCursor(1, 0);                       //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ1ÁÐ
 966   4                      ShowLcdStr("  00:00:00 00   ");           //ÏÔÊ¾ÇåÁã
 967   4                      DelayMs(10);                //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 968   4              while(!Key5);               //µÈ´ý°´¼üÊÍ·Å
 969   4              DelayMs(10);                              //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼üËÉ¿ªµÄ¶¶¶¯
 970   4                  }
 971   3                  
 972   3                  if(TR1 == 1)
 973   3                  {
 974   4                      SetLcdCursor(1, 2);                       //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ3ÁÐ
 975   4                      ShowLcdNum(Stop_Watch_Second/3600);       //Ð¡Ê±
 976   4                      SetLcdCursor(1, 5);                       //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ6ÁÐ
 977   4                      ShowLcdNum(Stop_Watch_Second%3600/60);    //·ÖÖÓ
 978   4                      SetLcdCursor(1, 8);                       //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ9ÁÐ
 979   4                      ShowLcdNum(Stop_Watch_Second%60);         //ÃëÖÓ
 980   4                      SetLcdCursor(1, 11);                      //ÉèÖÃ×ø±êµÚ2ÐÐ£¬µÚ12ÁÐ
 981   4                      ShowLcdNum(Stop_Watch_Count);             //ºÁÃë
 982   4                  }
 983   3              }
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 17  

 984   2              // ÍË³öÃë±í£¬»Øµ½Ê±ÖÓÄ£Ê½
 985   2              KeySound();                                       //°´¼ü°´ÏÂÈ¥·¢³öÌáÊ¾Òô
 986   2              TR1 = 0;                                          //Í£Ö¹¶¨Ê±Æ÷
 987   2              Stop_Watch_Count = 0;                             //¼ÆÊý±äÁ¿1ÇåÁã
 988   2              Stop_Watch_Second = 0;                            //¼ÆÊý±äÁ¿2ÇåÁã
 989   2              ShowLcdInit();                                    //Òº¾§ÏÔÊ¾Ê±ÖÓ½çÃæ
 990   2              DelayMs(10);                                      //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯
 991   2              while(!Key3);                                     //µÈ´ý°´¼üÊÍ·Å
 992   2              DelayMs(10);                                      //ÑÓÊ±µÈ´ý£¬Ïû³ý°´¼ü°´ÏÂµÄ¶¶¶¯       
 993   2          }
 994   1      }
 995          /*********************************************************/
 996          // ÄÖÖÓÅÐ¶Ï
 997          /*********************************************************/
 998          void ClockJudge()
 999          {
1000   1        if(Clock_Swt == 1)                                //ÅÐ¶ÏÄÖÖÓµÄ¿ª¹ØÊÇ·ñ¿ªÆô
1001   1        {
1002   2          if((Clock_Hour==TimeBuff[4]) && (Clock_Minute==TimeBuff[5]))    //µ±Ç°Ð¡Ê±ºÍ·ÖÖÓ£¬ºÍÄÖÖÓµÄÐ¡Ê±ºÍ·ÖÖÓÊÇ·ñÒ»
             -ÖÂ
1003   2          {
1004   3            if(TimeBuff[6] == 0)              //ÃëÊýÊÇ·ñµÈÓÚ0
1005   3            {
1006   4              Buzzer_Flag = 1;              //¿ªÆô·äÃùÆ÷±¨¾¯±êÖ¾
1007   4            }
1008   3          }
1009   2        }
1010   1        
1011   1        if(TimeBuff[6] == 59)                 //Èç¹ûµ±Ç°ÃëÊýÎª59Ãë
1012   1        {
1013   2          Buzzer_Flag = 0;                    //¹Ø±Õ·äÃùÆ÷±¨¾¯±êÖ¾
1014   2        }
1015   1        
1016   1        if((Key4==0)||(Key5==0))                        //Èç¹ûKey4»òKey5±»°´ÏÂ£¬¹Ø±Õ·äÃùÆ÷
1017   1        {
1018   2          Buzzer_Flag = 0;                    //¹Ø±Õ·äÃùÆ÷±¨¾¯±êÖ¾
1019   2        }
1020   1        
1021   1        if(Buzzer_Flag == 1)                  //Èç¹û·äÃùÆ÷±¨¾¯±êÖ¾ÎªÆô¶¯
1022   1        {
1023   2          Buzzer = 0;                     //Æô¶¯·äÃùÆ÷
1024   2          DelayMs(50);                    //ÑÓÊ±0.05Ãë
1025   2          Buzzer = 1;                     //¹Ø±Õ·äÃùÆ÷
1026   2          DelayMs(50);                    //ÑÓÊ±0.05Ãë
1027   2        }
1028   1      }
1029          /*********************************************************/
1030          // ¶¨Ê±Æ÷³õÊ¼»¯£¬ÓÃÓÚÃë±í
1031          /*********************************************************/
1032          void Timer1Init()
1033          {
1034   1        TMOD = 0x10;                                  // Ê¹ÓÃ¶¨Ê±Æ÷1£¬¹¤×÷·½Ê½ÊÇ1  
1035   1        ET1  = 1;                                 // ¶¨Ê±Æ÷1ÖÐ¶ÏÊ¹ÄÜ
1036   1        EA   = 1;                                 // ´ò¿ª×ÜÖÐ¶Ï
1037   1      }
1038          /*********************************************************/
1039           //Ö÷º¯Êý
1040          /*********************************************************/
1041          void main()
1042          {
1043   1          int temp;                       //±£´æÎÂ¶ÈÖµ
1044   1        
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 18  

1045   1          Timer1Init();
1046   1        LcdInit();                        //Ö´ÐÐÒº¾§³õÊ¼»¯  
1047   1        DS1302_Init();                      //Ê±ÖÓÐ¾Æ¬µÄ³õÊ¼»¯
1048   1        ShowLcdInit();                      //Òº¾§ÏÔÊ¾ÄÚÈÝµÄ³õÊ¼»¯
1049   1         
1050   1        if(DS1302_Read_Byte(0x81) >= 128)                 //ÅÐ¶ÏÊ±ÖÓÐ¾Æ¬ÊÇ·ñÕýÔÚÔËÐÐ
1051   1        {
1052   2          DS1302_Write_Time();                  //Èç¹ûÃ»ÓÐ£¬Ôò³õÊ¼»¯Ò»¸öÊ±¼ä
1053   2        } 
1054   1          
1055   1        Clock_Hour = ReadE2PROM(0x2000);                  //¶ÁÈ¡0x2000Õâ¸öµØÖ·µÄÄÚÈÝ£¬¸³Öµ¸øÄÖÖÓµÄÐ¡Ê±±äÁ¿
1056   1        if(Clock_Hour > 23)                   //Èç¹û¶ÁÈ¡µ½µÄÄÖÖÓÐ¡Ê±ÊýÖµ²»Õý³££¬ÔòÖØÐÂ¸³Öµ
1057   1        {
1058   2          Clock_Hour = 12;
1059   2        }
1060   1          Clock_Minute = ReadE2PROM(0x2001);                    //¶ÁÈ¡0x2001Õâ¸öµØÖ·µÄÄÚÈÝ£¬¸³Öµ¸øÄÖÖÓµÄ·ÖÖÓ±äÁ¿
1061   1        if(Clock_Minute > 59)                 //Èç¹û¶ÁÈ¡µ½µÄÄÖÖÓ·ÖÖÓÊýÖµ²»Õý³££¬ÔòÖØÐÂ¸³Öµ
1062   1        { 
1063   2          Clock_Minute = 30;
1064   2        }
1065   1        Clock_Swt = ReadE2PROM(0x2002);                     //¶ÁÈ¡0x2002Õâ¸öµØÖ·µÄÄÚÈÝ£¬¸³Öµ¸øÄÖÖÓµÄ¿ª¹Ø±äÁ¿
1066   1        if(Clock_Swt > 1)                   //Èç¹û¶ÁÈ¡µ½µÄÄÖÖÓ¿ª¹ØÊýÖµ²»Õý³££¬ÔòÖØÐÂ¸³Öµ
1067   1        {
1068   2          Clock_Swt = 0;
1069   2        }
1070   1        
1071   1        while(Get18B20Temp() == 850)                      //µÈ´ýÎÂ¶È´«¸ÐÆ÷³õÊ¼»¯Íê³É
1072   1        {
1073   2          DelayMs(10);
1074   2        }
1075   1          
1076   1          while(1)
1077   1          {
1078   2              DS1302_Read_Time();                         //»ñÈ¡µ±Ç°Ê±ÖÓÐ¾Æ¬µÄÊ±¼ä£¬´æÔÚÊý×étime_bufÖÐ
1079   2          FlashTime();                        //Ë¢ÐÂÊ±¼äÏÔÊ¾
1080   2          ClockJudge();                       //ÄÖÖÓ¹¤×÷µÄÅÐ¶Ï
1081   2          
1082   2          temp = Get18B20Temp();                            //¶ÁÈ¡ÎÂ¶È
1083   2          SetLcdCursor(1,9);                      //¶¨Î»µ½ÏÔÊ¾ÎÂ¶ÈµÄµØ·½
1084   2          ShowLcdTemp(temp);                          //ÏÔÊ¾ÎÂ¶È
1085   2      
1086   2          KeyScanf1();                        //°´¼üÉ¨Ãè1(Ê±¼äµÄÉèÖÃ)
1087   2          KeyScanf2();                        //°´¼üÉ¨Ãè2(ÄÖÖÓµÄÉèÖÃ)
1088   2          KeyScanf3();                                      //°´¼üÉ¨Ãè3(½øÈëºÍÍË³öÃë±í)
1089   2              
1090   2          DelayMs(100);                       //ÑÓÊ±0.1Ãë
1091   2          }
1092   1      }
1093          
1094          /*********************************************************/
1095          // ¶¨Ê±Æ÷1·þÎñ³ÌÐò£¬ÓÃÓÚÃë±í
1096          /*********************************************************/
1097          void Timer1(void) interrupt 3
1098          {
1099   1          TH1 = 216;                                            // ¸ø¶¨Ê±Æ÷1µÄTH0×°³õÖµ£¬¶¨Ê±10ms
1100   1          TL1 = 240;                                            // ¸ø¶¨Ê±Æ÷1µÄTL0×°³õÖµ
1101   1          
1102   1          Stop_Watch_Count++;                                   //Stop_Watch_Count¼Ó1
1103   1          if(Stop_Watch_Count >= 100)                           //ÅÐ¶ÏÈç¹ûStop_Watch_CountÊÇ·ñ¼Óµ½100
1104   1          {
1105   2              Stop_Watch_Count = 0;                             //¼Óµ½100Ö®ºóStop_Watch_CountÇå0
1106   2              Stop_Watch_Second++;                              //Stop_Watch_Second¼Ó1£¬¼È¼Ó1Ãë
C51 COMPILER V9.52.0.0   MAIN                                                              07/30/2023 11:33:43 PAGE 19  

1107   2          }
1108   1      }
1109          
1110          
1111          
1112          
1113          
1114          
1115          
1116          
1117          
1118          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2837    ----
   CONSTANT SIZE    =    138    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
